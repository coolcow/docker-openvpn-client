# This Dockerfile is for running smoke tests on the OpenVPN client application image.

# The application image to test is passed as a build argument.
# The default value is for local testing.
ARG APP_IMAGE=ghcr.io/coolcow/openvpn-client:local-test-build
FROM ${APP_IMAGE}

# Run smoke tests directly inside the application image.
# If any command fails, the build will fail, indicating a problem.
RUN \
    test -x /usr/sbin/openvpn && \
    test -x /usr/local/bin/entrypoint.sh && \
    test -x /usr/local/bin/entrypoint_su-exec.sh && \
    test -x /usr/local/bin/ensure_user_group_home.sh && \
    echo "Checking openvpn version..." && \
    openvpn --version && \
    grep -q 'entrypoint_su-exec.sh openvpn' /usr/local/bin/entrypoint.sh